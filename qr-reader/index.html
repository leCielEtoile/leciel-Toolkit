<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; img-src 'self' data: blob:; media-src 'self' blob:; connect-src 'self';">
  <title>QRコード読み取りツール</title>
  <meta name="description" content="カメラまたは画像ファイルからQRコードを読み取り、内容を表示するツール">
  <link rel="stylesheet" href="../common.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
  <script>
    // FOUC（Flash of Unstyled Content）防止：ページ読み込み前にダークモード適用
    (function() {
      const darkModeEnabled = localStorage.getItem('darkMode') === 'enabled';
      const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const noPreference = !localStorage.getItem('darkMode');

      if (darkModeEnabled || (systemPrefersDark && noPreference)) {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>
</head>
<body>
  <header>
    <h1>QRコード読み取りツール</h1>
    <div class="header-controls">
      <a href="/" class="home-button" aria-label="ホームに戻る" title="ホームに戻る">
        <i class="fas fa-home"></i>
      </a>
      <button id="toggleDarkMode" class="toggle-dark" aria-label="ダークモード切替" title="ダークモード切替">
        <i class="fas fa-moon"></i>
      </button>
    </div>
  </header>

  <main>
    <div id="message" class="hidden"></div>

    <section class="scan-section">
      <h2>読み取り方法を選択</h2>
      <div class="button-group">
        <button id="cameraButton" class="primary-button">
          <i class="fas fa-camera"></i> カメラで読み取る
        </button>
        <button id="fileButton" class="secondary-button">
          <i class="fas fa-image"></i> 画像ファイルから読み取る
        </button>
      </div>
      <input type="file" id="fileInput" accept="image/*" class="hidden">
    </section>

    <section id="cameraSection" class="camera-section hidden">
      <h2>カメラプレビュー</h2>
      <div id="qr-reader"></div>
      <button id="stopCameraButton" class="danger-button">
        <i class="fas fa-stop"></i> カメラを停止
      </button>
    </section>

    <section id="resultSection" class="result-section hidden">
      <h2>読み取り結果</h2>
      <div class="result-container">
        <div class="result-header">
          <i class="fas fa-check-circle success-icon"></i>
          <p class="result-label">QRコードの内容:</p>
        </div>
        <div id="resultText" class="result-text"></div>
        <button id="copyButton" class="copy-button">
          <i class="fas fa-copy"></i> コピー
        </button>
      </div>
    </section>

    <section class="help-section">
      <details>
        <summary>使い方ガイド</summary>
        <div class="help-content">
          <h3>このツールについて</h3>
          <p>カメラまたは画像ファイルからQRコードを読み取り、その内容を平文で表示します。すべての処理はブラウザ上で実行され、読み取った内容はサーバーに送信されません。</p>

          <h3>カメラで読み取る</h3>
          <ol>
            <li>「カメラで読み取る」ボタンをクリックします</li>
            <li>カメラへのアクセスを許可します</li>
            <li>QRコードをカメラに向けます</li>
            <li>自動的に読み取られ、結果が表示されます</li>
          </ol>

          <h3>画像ファイルから読み取る</h3>
          <ol>
            <li>「画像ファイルから読み取る」ボタンをクリックします</li>
            <li>QRコードが含まれる画像ファイルを選択します</li>
            <li>自動的に読み取られ、結果が表示されます</li>
          </ol>

          <h3>注意事項</h3>
          <ul>
            <li><strong>完全プライバシー保護:</strong> すべての処理はブラウザ上で実行され、データはサーバーに送信されません</li>
            <li>QRコードは明るい場所で、カメラに正面から向けると読み取りやすくなります</li>
            <li>画像ファイルはPNG、JPEG、WebP等の一般的な形式に対応しています</li>
            <li>カメラ機能を使用するには、HTTPSでの接続が必要です（localhost除く）</li>
          </ul>
        </div>
      </details>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 QRコード読み取りツール</p>
  </footer>

  <script type="module" src="qr-scanner.js"></script>
</body>
</html>
